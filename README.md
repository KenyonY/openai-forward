**ä¸­æ–‡** | ~~[**English**](./README_EN.md)~~

<h1 align="center">
    <br>
    OpenAI Forward
    <br>
</h1>
<p align="center">
    <b> OpenAI APIé£æ ¼æ¥å£è½¬å‘æœåŠ¡ <br/>
    The fastest way to deploy llms api forwarding </b>
</p>

<p align="center">
    <a href="https://pypi.org/project/openai-forward/"><img src="https://img.shields.io/pypi/v/openai-forward?color=brightgreen" alt="PyPI version" ></a>
    <a href="https://github.com/beidongjiedeguang/openai-forward/blob/main/LICENSE">
        <img alt="License" src="https://img.shields.io/github/license/beidongjiedeguang/openai-forward.svg?color=blue&style=flat-square">
    </a>
    <a href="https://github.com/beidongjiedeguang/openai-forward/releases">
        <img alt="Release (latest by date)" src="https://img.shields.io/github/v/release/beidongjiedeguang/openai-forward">
    </a>
    <a href="https://github.com/beidongjiedeguang/openai-forward">
        <img alt="GitHub repo size" src="https://img.shields.io/github/repo-size/beidongjiedeguang/openai-forward">
    </a>
    <a href="https://hub.docker.com/r/beidongjiedeguang/openai-forward">
        <img alt="docker image size" src="https://img.shields.io/docker/image-size/beidongjiedeguang/openai-forward?style=flat&label=docker image">
    </a>
    <a href="https://github.com/beidongjiedeguang/openai-forward/actions/workflows/ci.yml">
        <img alt="tests" src="https://img.shields.io/github/actions/workflow/status/beidongjiedeguang/openai-forward/ci.yml?label=tests">
    </a>
    <a href="https://pypistats.org/packages/openai-forward">
        <img alt="pypi downloads" src="https://img.shields.io/pypi/dm/openai_forward">
    </a>
    <a href="https://codecov.io/gh/beidongjiedeguang/openai-forward">
        <img alt="codecov" src="https://codecov.io/gh/beidongjiedeguang/openai-forward/branch/dev/graph/badge.svg">
    </a>
</p>

<div align="center">

[![Deploy to Render](https://render.com/images/deploy-to-render-button.svg)](https://render.com/deploy?repo=https://github.com/beidongjiedeguang/openai-forward)

[ç‰¹ç‚¹](#ç‰¹ç‚¹) |
[éƒ¨ç½²æŒ‡å—](deploy.md) |
[ä½¿ç”¨](#ä½¿ç”¨) |
[é…ç½®](#é…ç½®) |
[å¯¹è¯æ—¥å¿—](#å¯¹è¯æ—¥å¿—)


</div>

OpenAI-Forwardæ˜¯å¤§æ¨¡å‹ä¸ç”¨æˆ·å±‚ä¹‹é—´çš„ä¸€é“è½¬å‘æœåŠ¡ï¼Œ
ç”¨äºå¯¹è¯·æ±‚æ¨¡å‹çš„é€Ÿç‡é™åˆ¶ï¼Œæ¨¡å‹è¿”å›çš„Tokené€Ÿç‡é™åˆ¶ï¼Œè‡ªå®šä¹‰API KEY ç­‰ã€‚



<a>
   <img src="https://raw.githubusercontent.com/beidongjiedeguang/openai-forward/main/.github/images/separators/aqua.png" height=8px width="100%">
</a>

## ç‰¹ç‚¹

OpenAI-Forwardæ”¯æŒä»¥ä¸‹åŠŸèƒ½:

- **ä¸‡èƒ½ä»£ç†**: å‡ ä¹å¯ä»¥è½¬å‘ä»»ä½•è¯·æ±‚
- **ç”¨æˆ·é€Ÿç‡é™åˆ¶**: æä¾›è¯·æ±‚é€Ÿç‡é™åˆ¶(**RPM**)ä¸æµå¼è¿”å›çš„Tokené€Ÿç‡é™åˆ¶(**TPM**)
- **è‡ªå®šä¹‰ç§˜é’¥**: æ”¯æŒç”¨æˆ·ä½¿ç”¨è‡ªå®šä¹‰ç”Ÿæˆçš„ç§˜é’¥ä»£æ›¿åŸå§‹api keyä½¿ç”¨ã€‚
- æµå¼å“åº”çš„å¯¹è¯æ—¥å¿—
- å¯åŒæ—¶è½¬å‘å¤šä¸ªç›®æ ‡æœåŠ¡è‡³ä¸åŒè·¯ç”±
- å¤±è´¥è¯·æ±‚è‡ªåŠ¨é‡è¯•
- ä¸€åˆ†é’Ÿå†…å®Œæˆå®‰è£…ä¸éƒ¨ç½²; ä¸€é”®éƒ¨ç½²è‡³äº‘ç«¯
- ...

ç”±æœ¬é¡¹ç›®æ­å»ºçš„ä»£ç†æœåŠ¡åœ°å€ï¼š
> https://api.openai-forward.com  
> https://render.openai-forward.com

<font size=2 >
æ³¨ï¼šè¿™é‡Œæä¾›çš„ä»£ç†æœåŠ¡ä»…ä¾›å­¦ä¹ ä½¿ç”¨ã€‚
</font>


## éƒ¨ç½²æŒ‡å—

 ğŸ‘‰ [éƒ¨ç½²æ–‡æ¡£](deploy.md)


<a>
   <img src="https://raw.githubusercontent.com/beidongjiedeguang/openai-forward/main/.github/images/separators/aqua.png" height=8px width="100%">
</a>

## ä½¿ç”¨
**å®‰è£…**
```bash
pip install openai-forward
```
**è¿è¡Œ**
```bash
aifd run
```
å¦‚æœè¯»å…¥äº†æ ¹è·¯å¾„çš„`.env`çš„é…ç½®, å°†ä¼šçœ‹åˆ°ä»¥ä¸‹å¯åŠ¨ä¿¡æ¯

```bash
â¯ aifd run
â•­â”€â”€â”€â”€â”€â”€ ğŸ¤— openai-forward is ready to serve!  â”€â”€â”€â”€â”€â”€â”€â•®
â”‚                                                    â”‚
â”‚  base url         https://api.openai.com           â”‚
â”‚  route prefix     /                                â”‚
â”‚  api keys         False                            â”‚
â”‚  forward keys     False                            â”‚
â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯
â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â±ï¸ Rate Limit configuration â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®
â”‚                                                    â”‚
â”‚  strategy               moving-window              â”‚
â”‚  /healthz               100/2minutes (req)         â”‚
â”‚  /v1/chat/completions   60/minute;600/hour (req)   â”‚
â”‚  /v1/chat/completions   40/second (token)          â”‚
â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯
INFO:     Started server process [33811]
INFO:     Waiting for application startup.
INFO:     Application startup complete.
INFO:     Uvicorn running on http://0.0.0.0:8000 (Press CTRL+C to quit)
```

### ä»£ç†OpenAI API:
è¿™ä¹Ÿæ˜¯`aifd run`çš„é»˜è®¤é€‰é¡¹

#### åœ¨ç¬¬ä¸‰æ–¹åº”ç”¨ä¸­ä½¿ç”¨

<details >
   <summary> ç‚¹å‡»å±•å¼€</summary>  

åŸºäºå¼€æºé¡¹ç›®[ChatGPT-Next-Web](https://github.com/Yidadaa/ChatGPT-Next-Web)æ­å»ºè‡ªå·±çš„chatgptæœåŠ¡  
æ›¿æ¢dockerå¯åŠ¨å‘½ä»¤ä¸­çš„ `BASE_URL`ä¸ºè‡ªå·±æ­å»ºçš„ä»£ç†æœåŠ¡åœ°å€

```bash 
docker run -d \
    -p 3000:3000 \
    -e OPENAI_API_KEY="sk-******" \
    -e BASE_URL="https://api.openai-forward.com" \
    -e CODE="******" \
    yidadaa/chatgpt-next-web 
``` 

</details>

#### åœ¨ä»£ç ä¸­ä½¿ç”¨

<details >
  <summary>ç‚¹å‡»å±•å¼€</summary>

**Python**

```diff
  import openai
+ openai.api_base = "https://api.openai-forward.com/v1"
  openai.api_key = "sk-******"
```

**JS/TS**

```diff
  import { Configuration } from "openai";
  
  const configuration = new Configuration({
+ basePath: "https://api.openai-forward.com/v1",
  apiKey: "sk-******",
  });
```

**gpt-3.5-turbo**

```bash
curl https://api.openai-forward.com/v1/chat/completions \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer sk-******" \
  -d '{
    "model": "gpt-3.5-turbo",
    "messages": [{"role": "user", "content": "Hello!"}]
  }'
```

**Image Generation (DALL-E)**

```bash
curl --location 'https://api.openai-forward.com/v1/images/generations' \
--header 'Authorization: Bearer sk-******' \
--header 'Content-Type: application/json' \
--data '{
    "prompt": "A photo of a cat",
    "n": 1,
    "size": "512x512"
}'
```

</details>

### ä»£ç†æœ¬åœ°æ¨¡å‹

ä¸ [LocalAI](https://github.com/go-skynet/LocalAI)ï¼Œ
[api-for-open-llm](https://github.com/xusenlinzy/api-for-open-llm)ç­‰
ä¸€èµ·ä½¿ç”¨ï¼Œèµ‹äºˆè¿™äº›æœåŠ¡æ¥å£çš„ç”¨æˆ·è¯·æ±‚é€Ÿç‡é™åˆ¶ï¼Œtokenè¾“å‡ºé€Ÿç‡é™åˆ¶ï¼Œå¯¹è¯æ—¥å¿—è¾“å‡ºç­‰èƒ½åŠ›ã€‚  

ä»¥LocalAIä¸ºä¾‹ï¼š  
å‡è®¾éƒ¨ç½²çš„LocalAIæœåŠ¡è¿è¡Œåœ¨ `http://localhost:8080`ï¼Œ
é‚£ä¹ˆæ¥ä¸‹æ¥åªéœ€ä¿®æ”¹ç¯å¢ƒå˜é‡(æˆ–[.env](.env)æ–‡ä»¶)ä¸­`OPENAI_BASE_URL=http://localhost:8080` å°±å¯ä»¥å®Œæˆå¯¹LocalAIçš„ä»£ç†ï¼Œ
ç„¶åå³å¯åœ¨`aifd`çš„é»˜è®¤æœåŠ¡ç«¯å£`http://localhost:8000`ä¸­è®¿é—®LocalAI.

(å¾…è¡¥å……)

### ä»£ç†å…¶å®ƒäº‘ç«¯æ¨¡å‹

ä¾‹å¦‚å¯é€šè¿‡ [claude-to-chatgpt](https://github.com/jtsang4/claude-to-chatgpt)
å°†claudeçš„apiæ ¼å¼å¯¹é½ä¸ºopenaiçš„æ ¼å¼ï¼Œç„¶åä½¿ç”¨`openai-forward`è¿›è¡Œä»£ç†ã€‚
(å¾…è¡¥å……)

<a>
   <img src="https://raw.githubusercontent.com/beidongjiedeguang/openai-forward/main/.github/images/separators/aqua.png" height=8px width="100%">
</a>


## é…ç½®

### å‘½ä»¤è¡Œå‚æ•°

å¯é€šè¿‡ `aifd run --help` æŸ¥çœ‹

<details open>
  <summary>Click for more details</summary>

**`aifd run`å‚æ•°é…ç½®é¡¹**

| é…ç½®é¡¹        | è¯´æ˜         |   é»˜è®¤å€¼   |
|------------|------------|:-------:|
| --port     | æœåŠ¡ç«¯å£å·      |  8000   |
| --workers  | å·¥ä½œè¿›ç¨‹æ•°      |    1    |
| --log_chat | åŒ LOG_CHAT | `False` |

</details>

### ç¯å¢ƒå˜é‡é…ç½®é¡¹

æ”¯æŒä»è¿è¡Œç›®å½•ä¸‹çš„`.env`æ–‡ä»¶ä¸­è¯»å–  
é…ç½®ç¤ºä¾‹è§æ ¹ç›®å½•ä¸‹çš„ [.env.example](.env.example)

| ç¯å¢ƒå˜é‡                | è¯´æ˜                                                                                                                                |          é»˜è®¤å€¼           |
|---------------------|-----------------------------------------------------------------------------------------------------------------------------------|:----------------------:|
| OPENAI_BASE_URL     | é»˜è®¤ openaiå®˜æ–¹ api åœ°å€                                                                                                                | https://api.openai.com |
| OPENAI_ROUTE_PREFIX | openai(æ¥å£æ ¼å¼)è·¯ç”±å‰ç¼€                                                                                                                  |           /            |
| OPENAI_API_KEY      | é»˜è®¤openai api keyï¼Œæ”¯æŒå¤šä¸ªé»˜è®¤api key, ä»¥ `sk-` å¼€å¤´ï¼Œ ä»¥é€—å·åˆ†éš”                                                                                 |           æ—             |
| FORWARD_KEY         | å…è®¸è°ƒç”¨æ–¹ä½¿ç”¨è¯¥keyä»£æ›¿openai api keyï¼Œæ”¯æŒå¤šä¸ªforward key, ä»¥é€—å·åˆ†éš”; å¦‚æœè®¾ç½®äº†OPENAI_API_KEYï¼Œè€Œæ²¡æœ‰è®¾ç½®FORWARD_KEY, åˆ™å®¢æˆ·ç«¯è°ƒç”¨æ—¶æ— éœ€æä¾›å¯†é’¥, æ­¤æ—¶å‡ºäºå®‰å…¨è€ƒè™‘ä¸å»ºè®®FORWARD_KEYç½®ç©º |           æ—             |
| EXTRA_BASE_URL      | é¢å¤–è½¬å‘æœåŠ¡åœ°å€                                                                                                                          |           æ—             |
| EXTRA_ROUTE_PREFIX  | é¢å¤–è½¬å‘æœåŠ¡è·¯ç”±å‰ç¼€                                                                                                                        |           æ—             |
| REQ_RATE_LIMIT      | æŒ‡å®šè·¯ç”±çš„è¯·æ±‚é€Ÿç‡é™åˆ¶ï¼ˆåŒºåˆ†ç”¨æˆ·ï¼‰                                                                                                                 |           æ—             |
| GLOBAL_RATE_LIMIT   | æ‰€æœ‰`REQ_RATE_LIMIT`æ²¡æœ‰æŒ‡å®šçš„è·¯ç”±. ä¸å¡«é»˜è®¤æ— é™åˆ¶                                                                                                |           æ—             |
| RATE_LIMIT_STRATEGY | é€Ÿç‡é™åˆ¶ç­–ç•¥(fixed-window, fixed-window-elastic-expiry, moving-window)                                                                  |           æ—             |
| TOKEN_RATE_LIMIT    | å¯¹æ¯ä¸€ä»½æµå¼è¿”å›çš„tokené€Ÿç‡é™åˆ¶ (è¿™é‡Œçš„tokenå¹¶ä¸ä¸¥æ ¼ç­‰äºgptä¸­å®šä¹‰çš„tokenï¼Œè€Œæ˜¯SSEçš„chunk)                                                                       |           æ—             |
| PROXY               | httpä»£ç†                                                                                                                            |           æ—             |
| LOG_CHAT            | æ˜¯å¦è®°å½•èŠå¤©å†…å®¹                                                                                                                          |        `false`         |

æ›´å¤šè§ [.env.example](.env.example) ä¸­çš„è¯´æ˜ã€‚(å¾…å®Œå–„)

### è‡ªå®šä¹‰ç§˜é’¥

<details open>
  <summary>Click for more details</summary>

éœ€è¦é…ç½® OPENAI_API_KEY å’Œ FORWARD_KEY, å¦‚

```bash
OPENAI_API_KEY=sk-*******
FORWARD_KEY=fk-****** # è¿™é‡Œfk-tokenç”±æˆ‘ä»¬è‡ªå·±å®šä¹‰
```

**ç”¨ä¾‹:**

```diff
  import openai
+ openai.api_base = "https://api.openai-forward.com/v1"
- openai.api_key = "sk-******"
+ openai.api_key = "fk-******"
```

</details>

### å¤šç›®æ ‡æœåŠ¡è½¬å‘

æ”¯æŒè½¬å‘ä¸åŒåœ°å€çš„æœåŠ¡è‡³åŒä¸€ç«¯å£çš„ä¸åŒè·¯ç”±ä¸‹
ç”¨ä¾‹è§  `.env.example`

### å¯¹è¯æ—¥å¿—

é»˜è®¤ä¸è®°å½•å¯¹è¯æ—¥å¿—ï¼Œè‹¥è¦å¼€å¯éœ€è®¾ç½®ç¯å¢ƒå˜é‡`LOG_CHAT=true`
<details open>
  <summary>Click for more details</summary>

ä¿å­˜è·¯å¾„åœ¨å½“å‰ç›®å½•ä¸‹çš„`Log/chat`è·¯å¾„ä¸­ã€‚  
è®°å½•æ ¼å¼ä¸º

```text
{'messages': [{'user': 'hi'}], 'model': 'gpt-3.5-turbo', 'forwarded-for': '', 'uid': '467a17ec-bf39-4b65-9ebd-e722b3bdd5c3', 'datetime': '2023-07-18 14:01:21'}
{'assistant': 'Hello there! How can I assist you today?', 'uid': '467a17ec-bf39-4b65-9ebd-e722b3bdd5c3'}
{'messages': [{'user': 'Hello!'}], 'model': 'gpt-3.5-turbo', 'forwarded-for': '', 'uid': 'f844d156-e747-4887-aef8-e40d977b5ee7', 'datetime': '2023-07-18 14:01:23'}
{'assistant': 'Hi there! How can I assist you today?', 'uid': 'f844d156-e747-4887-aef8-e40d977b5ee7'}
```

è½¬æ¢ä¸º`json`æ ¼å¼ï¼š

```bash
aifd convert
```

å¾—åˆ°`chat.json`ï¼š

```json
[
    {
        "datetime": "2023-07-18 14:01:21",
        "forwarded-for": "",
        "model": "gpt-3.5-turbo",
        "messages": [
            {
                "user": "hi"
            }
        ],
        "assistant": "Hello there! How can I assist you today?"
    },
    {
        "datetime": "2023-07-18 14:01:23",
        "forwarded-for": "",
        "model": "gpt-3.5-turbo",
        "messages": [
            {
                "user": "Hello!"
            }
        ],
        "assistant": "Hi there! How can I assist you today?"
    }
]
```

</details>

## Backer and Sponsor

<a href="https://www.jetbrains.com/?from=beidongjiedeguang/openai-forward" target="_blank">
<img src=".github/images/jetbrains.svg" width="100px" height="100px">
</a>

## License

OpenAI-Forward is licensed under the [MIT](https://opensource.org/license/mit/) license.
